<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitorar Processos INSS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/png" sizes="32x32" href="./favicon_final_rounded.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        body {
            background-color: #f4f4f9;
        }
        .input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }
        .button:hover {
            transform: scale(1.05);
            transition: transform 0.3s ease;
        }
        .expandable {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        .expanded {
            max-height: 500px;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-start bg-gray-100">
    <div class="container mx-auto p-6 animate__animated animate__fadeIn">
        <!-- Filtros -->
        <div class="mb-6 flex justify-between items-center animate__animated animate__fadeInDown">
            <div>
                <label for="cpf-input" class="block text-sm font-medium text-gray-700">Pesquisar por CPF:</label>
                <input type="text" id="cpf-input" class="input mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm transition-all duration-300 ease-in-out">
            </div>
            <div class="ml-6">
                <label for="protocolo-input" class="block text-sm font-medium text-gray-700">Pesquisar por Protocolo:</label>
                <input type="text" id="protocolo-input" class="input mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm transition-all duration-300 ease-in-out">
            </div>
            <div class="ml-6">
                <label for="status-filter" class="block text-sm font-medium text-gray-700">Filtrar por Status:</label>
                <select id="status-filter" class="input mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm transition-all duration-300 ease-in-out">
                    <option value="">Todos</option>
                    <option value="Concluído">Concluído</option>
                    <option value="Análise">Análise</option>
                    <option value="Pendente">Pendente</option>
                </select>
            </div>
            <div class="ml-6 mt-5">
                <button id="search-btn" class="button bg-blue-500 text-white p-2 rounded-lg shadow-lg transform transition-all duration-300 ease-in-out">
                    <span class="mr-2">Pesquisar</span>
                </button>
            </div>
        </div>

        <!-- Ordenar por com Itens por Página fixado no canto direito -->
        <div class="mb-4 flex items-center justify-between">
            <div class="flex space-x-4">
                <div>
                    <label for="sort-by" class="block text-sm font-medium text-gray-700">Ordenar por:</label>
                    <select id="sort-by" class="input mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm transition-all duration-300 ease-in-out">
                        <option value="data">Data</option>
                        <option value="status">Status</option>
                    </select>
                </div>
                <div>
                    <label for="sort-order" class="block text-sm font-medium text-gray-700">Ordem:</label>
                    <select id="sort-order" class="input mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm transition-all duration-300 ease-in-out">
                        <option value="asc">Ascendente</option>
                        <option value="desc">Descendente</option>
                    </select>
                </div>
            </div>
            <div class="ml-auto">
                <label for="items-per-page" class="block text-sm font-medium text-gray-700">Itens por Página:</label>
                <select id="items-per-page" class="input mt-1 block w-32 p-2 border border-gray-300 rounded-md shadow-sm transition-all duration-300 ease-in-out">
                    <option value="5">5</option>
                    <option value="10" selected>10</option>
                    <option value="20">20</option>
                </select>
            </div>
        </div>

        <!-- Lista de Pedidos -->
        <div id="pedidos-container" class="w-full">
            <!-- Pedidos serão renderizados aqui -->
        </div>

        <!-- Paginação -->
        <div class="mt-4 flex justify-center animate__animated animate__fadeInUp">
            <button id="prev-page-btn" class="button bg-gray-300 p-2 rounded-lg shadow-lg mr-2">Página Anterior</button>
            <span id="page-info" class="mx-4"></span>
            <button id="next-page-btn" class="button bg-gray-300 p-2 rounded-lg shadow-lg ml-2">Próxima Página</button>
        </div>
    </div>

    <script>
        let pedidos = [];
        let currentPage = 1;
        let itemsPerPage = 10;

        // Função para buscar os pedidos da função serverless no Netlify
        function fetchPedidos() {
            fetch('/.netlify/functions/fetchPedidos') // Chama a função serverless no Netlify
                .then(response => response.json())
                .then(data => {
                    pedidos = data; // Armazena todos os pedidos
                    renderPedidos(pedidos, currentPage); // Renderiza a primeira página
                })
                .catch(error => {
                    console.error('Erro ao buscar dados da API:', error);
                });
        }

        // Função para renderizar os pedidos na página
        function renderPedidos(pedidos, page) {
            const container = document.getElementById('pedidos-container');
            container.innerHTML = ''; // Limpa o conteúdo anterior

            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = page * itemsPerPage;
            const pedidosPaginados = pedidos.slice(startIndex, endIndex);

            if (pedidosPaginados.length === 0) {
                container.innerHTML = '<p class="text-red-500 animate__animated animate__fadeIn">Nenhum pedido encontrado.</p>';
                return;
            }

            pedidosPaginados.forEach((pedido, index) => {
                const pedidoDiv = document.createElement('div');
                pedidoDiv.classList.add('bg-white', 'shadow-lg', 'rounded-lg', 'p-4', 'mb-4', 'animate__animated', 'animate__fadeIn');

                let statusColor = 'text-gray-500';
                if (pedido.status === 'Concluído') {
                    statusColor = 'text-green-500';
                } else if (pedido.status === 'Análise') {
                    statusColor = 'text-yellow-500';
                } else if (pedido.status === 'Pendente') {
                    statusColor = 'text-red-500';
                }

                pedidoDiv.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div class="flex items-center">
                            <span class="text-gray-500 font-semibold mr-2">CPF:</span>
                            <span class="text-gray-800 font-bold">${pedido.cpf}</span>
                            <span class="ml-4 ${statusColor}">(${pedido.status})</span>
                        </div>
                    </div>
                `;

                container.appendChild(pedidoDiv);
            });

            document.getElementById('page-info').innerText = `Página ${currentPage} de ${Math.ceil(pedidos.length / itemsPerPage)}`;
        }

        // Chama a função para buscar e renderizar os pedidos no carregamento da página
        fetchPedidos();
    </script>
</body>
</html>
